<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Checkout - Wells Fashion</title>
  <script src="./usingtw.js"></script>
</head>
<body class="bg-gray-50 font-sans">

  <!-- Header -->
  <header class="bg-white shadow p-4 sticky top-0 z-50">
    <h1 class="text-2xl font-bold text-center">Checkout</h1>
  </header>

  <main class="max-w-6xl mx-auto mt-6 grid grid-cols-1 md:grid-cols-2 gap-8 p-4">

    <!-- Billing Details -->
    <section class="bg-white p-6 shadow rounded">
      <h2 class="text-xl font-semibold mb-4">shipping Details</h2>

      <form id="checkoutForm" class="space-y-4">
        
          <div>
            <label class="block text-sm font-medium">First Name *</label>
            <input type="text" id="nameInput" class="w-full border rounded px-3 py-2 focus:outline-none focus:ring" required>
          </div>
         
        </div>

        <div>
          <label class="block text-sm font-medium">Country / Region *</label>
          <select class="w-full border rounded px-3 py-2">
            <option>Nigeria</option>
            <option>Ghana</option>
            <option>South Africa</option>
          </select>
        </div>

        <div>
          <label class="block text-sm font-medium">Street Address *</label>
          <input type="text" id="addressInput" class="w-full border rounded px-3 py-2 focus:outline-none focus:ring" required>
        </div>

        <div>
          <label class="block text-sm font-medium">Town / City *</label>
          <input type="text" class="w-full border rounded px-3 py-2" required>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium">State *</label>
            <select class="w-full border rounded px-3 py-2">
              <option>Lagos</option>
              <option>Abuja</option>
              <option>Ogun</option>
              <option>Ekiti</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium">Phone *</label>
            <input type="tel" id="phoneInput" class="w-full border rounded px-3 py-2 focus:outline-none focus:ring" required>
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium">Email *</label>
          <input type="email"  class="w-full border rounded px-3 py-2" required>
        </div>
      </form>
    </section>

    <!-- Order Summary -->
    <section class="bg-white p-6 shadow rounded" id="orderSummary">
      <h2 class="text-xl font-semibold mb-4">Your Order</h2>

      <div id="orderItems" class="space-y-2 border-b pb-2 mb-4 text-sm"></div>

      <div class="mb-4">
        <p class="font-semibold mb-1">Shipping</p>
        <label class="block">
          <input type="radio" name="shipping" value="0" checked> Free Shipping
        </label>
        <label class="block">
          <input type="radio" name="shipping" value="2000"> Flat Rate ‚Ç¶2,000
        </label>
      </div>

      <div class="flex justify-between font-semibold text-lg mb-4">
        <span>Total</span>
        <span id="subtotal">‚Ç¶0</span>
      </div>

      <div class="mb-4 text-sm">
        <p class="font-semibold mb-1">Invoice Payment</p>
        <p>Kindly proceed with your order by making payment to the available account and send the admin a screenshot of our order and payment slip.</p>
        <p class="mt-2 font-semibold">Akinmutimi Abiodun</p>
        <p>KUDA MFB</p>
        <p>Account No: <span class="font-bold">2014887237</span></p>
      </div>

      <button id="placeOrderBtn" class="w-full bg-black text-white py-3 rounded font-semibold hover:bg-gray-800 transition">
        Place Order
      </button>

      <p class="text-xs text-gray-500 mt-2 text-center">
        Your personal data will be used to process your order and improve your experience.  
        Read our <a href="#" class="text-red-600 underline">privacy policy</a>.
      </p>
    </section>

  </main>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const orderItems = document.getElementById("orderItems");
  const subtotalEl = document.getElementById("subtotal");
  const placeOrderBtn = document.getElementById("placeOrderBtn");

  const cart = JSON.parse(localStorage.getItem("cart")) || [];

  let subtotal = 0;
  if (cart.length === 0) {
    orderItems.innerHTML = `<p class="text-gray-500">No items in your cart.</p>`;
  } else {
    orderItems.innerHTML = cart.map(item => {
      const itemTotal = item.price * item.qty;
      subtotal += itemTotal;
      return `
        <div class="flex items-center justify-between border-b pb-2 mb-2">
          <div class="flex items-center gap-3">
            <img src="${item.img}" alt="${item.title}" class="w-14 h-14 object-cover rounded">
            <div>
              <p class="font-semibold">${item.title}</p>
              <p class="text-sm text-gray-500">${item.category} √ó ${item.qty}</p>
            </div>
          </div>
          <span class="font-medium">‚Ç¶${itemTotal.toLocaleString()}</span>
        </div>
      `;
    }).join('');
  }
  subtotalEl.textContent = "‚Ç¶" + subtotal.toLocaleString();

  // Shipping options
  const shippingOptions = document.querySelectorAll('input[name="shipping"]');
  let shippingCost = 0;
  function updateTotal() {
    const sel = document.querySelector('input[name="shipping"]:checked');
    shippingCost = sel ? parseInt(sel.value) : 0;
    const total = subtotal + shippingCost;
    subtotalEl.textContent = "‚Ç¶" + total.toLocaleString();
  }
  shippingOptions.forEach(opt => opt.addEventListener("change", updateTotal));
  updateTotal();

  placeOrderBtn.addEventListener("click", () => {
    const nameInput = document.getElementById("nameInput");
    const phoneInput = document.getElementById("phoneInput");
    const addressInput = document.getElementById("addressInput");

    // validate
    let valid = true;
    [nameInput, phoneInput, addressInput].forEach(f => f.classList.remove("border-red-500"));
    if (!nameInput.value.trim()) {
      nameInput.classList.add("border-red-500");
      valid = false;
    }
    if (!phoneInput.value.trim()) {
      phoneInput.classList.add("border-red-500");
      valid = false;
    }
    if (!addressInput.value.trim()) {
      addressInput.classList.add("border-red-500");
      valid = false;
    }
    if (!valid) return;

    // build message
    const orderId = "WF" + Date.now().toString().slice(-6);
    const date = new Date().toLocaleDateString("en-NG", {
      year: "numeric", month: "short", day: "numeric"
    });
    const total = subtotal + shippingCost;

    const itemsList = cart.map(item => `- ${item.title} √ó ${item.qty} ‚Äî ‚Ç¶${(item.price * item.qty).toLocaleString()}`)
                          .join("\n");

    const message =
`üõç New Order from Wells Fashion
üÜî Order ID: ${orderId}
üìÖ Date: ${date}

üë§ Name: ${nameInput.value.trim()}
üìû Phone: ${phoneInput.value.trim()}
üè† Address: ${addressInput.value.trim()}

üì¶ Items:
${itemsList}

üöö Shipping: ‚Ç¶${shippingCost.toLocaleString()}
üí∞ Total: ‚Ç¶${total.toLocaleString()}`;

    const phoneNumber = "2347032266397"; // your WhatsApp number
    const whatsappURL = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;

    // Try opening WhatsApp immediately
    const newWindow = window.open(whatsappURL, "_blank");

    // If it is blocked (null), fallback: redirect in current tab
    if (!newWindow) {
      window.location.href = whatsappURL;
    }

    // Show brief message overlay (optional)
    const alertBox = document.createElement("div");
    alertBox.innerHTML = `<div style="
      position:fixed;top:50%;left:50%;
      transform:translate(-50%,-50%);
      background:#000;color:#fff;
      padding:20px 30px;border-radius:10px;
      font-size:16px;text-align:center;z-index:9999;
    ">‚úÖ Sending order to WhatsApp...</div>`;
    document.body.appendChild(alertBox);

    // Cleanup after short delay
    setTimeout(() => {
      document.body.removeChild(alertBox);
      localStorage.removeItem("cart");
      // Optionally: redirect home
      window.location.href = "index.html";
    }, 1500);
  });
});
</script>

</body>
</html>